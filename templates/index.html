<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH V6.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020617; --neon: #22d3ee; --shadow: #f472b6; --accent: #f59e0b; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Rajdhani'; background-image: radial-gradient(circle, #0f172a 0%, #020617 100%); min-height: 100vh; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; }
        .neon-text { font-family: 'Orbitron'; background: linear-gradient(to right, var(--neon), #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .label-tech { font-size: 0.6rem; text-transform: uppercase; color: #94a3b8; letter-spacing: 2px; font-weight: 700; display: block; margin-bottom: 5px; }
        .box-pos { background: rgba(0,0,0,0.4); border: 1px solid #334155; border-radius: 10px; padding: 10px; text-align: center; }
        .num-main { font-family: 'Orbitron'; font-size: 1.5rem; color: #fff; text-shadow: 0 0 10px var(--neon); }
        .btn-run { background: linear-gradient(135deg, #0891b2, #4f46e5); border: none; color: white; font-weight: bold; padding: 12px; border-radius: 10px; width: 100%; font-family: 'Orbitron'; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.95); } }
        .animate-pulse { animation: pulse 2s infinite; }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="text-center mb-4">
        <h1 class="neon-text">MAMANG TECH V6.0</h1>
        <p class="text-secondary small">ABSOLUTE POSITION & TWIN ANALYTICS</p>
    </div>

    {% if not logged_in %}
    <div class="col-md-4 mx-auto glass text-center">
        <input type="password" id="key" class="form-control bg-dark text-white border-0 mb-3 text-center" placeholder="LICENSE KEY">
        <button class="btn btn-run" onclick="login()">AUTHENTICATE</button>
    </div>
    {% else %}
    <div class="col-md-6 mx-auto">
        <div class="glass mb-3">
            <select id="market" class="form-select bg-dark text-white border-0 mb-3">
                {% for m in markets %}<option value="{{m}}">{{m}}</option>{% endfor %}
            </select>
            <button class="btn btn-run" onclick="run()" id="btnGo">START DEEP ANALYZE</button>
        </div>

        <div id="resultArea" style="display:none;">
            <div class="glass mb-3 border-danger">
                <div class="text-center mb-3">
                    <span id="vTwinStatus" class="badge bg-danger animate-pulse mb-2"></span>
                    <div id="vTwinPicks" class="h4 text-white fw-bold" style="letter-spacing: 5px; font-family: 'Orbitron';"></div>
                    <small class="text-secondary">REKOMENDASI JAGA TWIN</small>
                </div>
            </div>

            <div class="glass mb-3 border-info">
                <div class="row g-2 mb-4">
                    <div class="col-4 box-pos"><span class="label-tech">2D DEPAN</span><div id="vDepan" class="small text-info fw-bold"></div></div>
                    <div class="col-4 box-pos"><span class="label-tech">2D TENGAH</span><div id="vTengah" class="small text-info fw-bold"></div></div>
                    <div class="col-4 box-pos" style="border-color:var(--neon)"><span class="label-tech" style="color:var(--neon)">2D BELAKANG</span><div id="vBelakang" class="small text-white fw-bold"></div></div>
                </div>

                <div class="p-3 bg-dark rounded border border-info mb-3 text-center">
                    <span class="label-tech" style="color:var(--neon)">CORE 2D BOM (BELAKANG)</span>
                    <div id="vCore" class="num-main"></div>
                </div>

                <div class="p-3 bg-dark rounded border border-secondary mb-3 text-center">
                    <span class="label-tech" style="color:var(--shadow)">SHADOW CADANGAN</span>
                    <div id="vShadow" class="text-secondary fw-bold" style="font-family: 'Orbitron';"></div>
                </div>

                <div class="p-2 bg-black rounded text-center">
                    <span class="label-tech" style="color:var(--accent)">BBFS CADANGAN (ASURANSI)</span>
                    <div id="vBbfs" class="h4 text-warning fw-bold" style="letter-spacing: 5px; font-family: 'Orbitron';"></div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function login() { $.post('/login', {key:$('#key').val()}, () => location.reload()); }
    function run() {
        $('#btnGo').prop('disabled', true).text('ANALYZING...');
        $.post('/analyze', {market: $('#market').val()}, (d) => {
            $('#btnGo').prop('disabled', false).text('START DEEP ANALYZE');
            $('#vTwinStatus').text(d.data.twin_status);
            $('#vTwinPicks').text(d.data.twin_picks);
            $('#vDepan').text(d.data.depan);
            $('#vTengah').text(d.data.tengah);
            $('#vBelakang').text(d.data.belakang);
            $('#vCore').text(d.data.core);
            $('#vShadow').text(d.data.shadow);
            $('#vBbfs').text(d.data.bbfs);
            $('#resultArea').fadeIn();
        });
    }
</script>
</body>
</html>
