<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI PRED v3 - MAMANG TECH</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { background-color: #0f172a; color: #fff; font-family: sans-serif; }
        .card { background-color: #1e293b; border: none; border-radius: 15px; }
        .text-green { color: #22c55e; }
        .result-box { background-color: #ffffff; color: #000; border-radius: 10px; padding: 15px; border-left: 5px solid #22c55e; }
        .badge-angka { background-color: #f8fafc; color: #000; font-size: 1.5rem; font-weight: 800; letter-spacing: 5px; border-radius: 10px; padding: 15px; text-align: center; border: 2px solid #cbd5e1; display: block; }
        .invest-text { font-size: 0.85rem; color: #86efac; word-break: break-all; }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-7">
            {% if not logged_in %}
            <div class="card p-4 text-center">
                <input type="password" id="key" class="form-control mb-2" placeholder="Input Key...">
                <button class="btn btn-success w-100" onclick="login()">Buka AI</button>
            </div>
            {% else %}
            <div class="card p-4 mb-3">
                <h3 class="text-center text-green fw-bold mb-4">MAMANG AI ENGINE v3</h3>
                <select id="market" class="form-select mb-3">
                    {% for m in markets %}<option value="{{ m }}">{{ m }}</option>{% endfor %}
                </select>
                <button class="btn btn-success w-100 fw-bold" onclick="analyze()" id="btnAn">PROSES DATA</button>
            </div>

            <div id="resultCard" class="card p-4 shadow-lg" style="display: none;">
                <div class="d-flex justify-content-between mb-4">
                    <h4 id="resMarket" class="text-green fw-bold"></h4>
                    <button class="btn btn-sm btn-light" onclick="takeSs()">ðŸ’¾ SIMPAN</button>
                </div>
                <div class="row g-2 mb-4">
                    <div class="col-6"><div class="result-box"><small>LAST:</small><br><span id="resLast" class="h3 fw-bold"></span></div></div>
                    <div class="col-6"><div class="result-box"><small>POSISI:</small><br><span id="resPosisi" class="fw-bold"></span></div></div>
                </div>
                <div class="mb-3">
                    <label class="small text-green fw-bold mb-1">BBFS CAMPURAN (MAX 6D)</label>
                    <div id="resBbfs" class="badge-angka"></div>
                </div>
                <div class="mb-3">
                    <label class="small text-info fw-bold mb-1">BBFS SHADOW (5D)</label>
                    <div id="resShadow" class="badge-angka" style="border-style: dashed; color: #0369a1;"></div>
                </div>
                <div class="row text-center mb-3">
                    <div class="col-6 small text-secondary">TOP 3D:<br><span id="res3d" class="text-white fw-bold"></span></div>
                    <div class="col-6 small text-secondary">TOP 4D:<br><span id="res4d" class="text-white fw-bold"></span></div>
                </div>
                <div class="p-3 bg-dark rounded">
                    <small class="text-green fw-bold">INVEST 2D UTAMA:</small>
                    <div id="res2dM" class="invest-text mb-2"></div>
                    <small class="text-info fw-bold">INVEST 2D SHADOW:</small>
                    <div id="res2dS" class="invest-text"></div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
function login() { $.post('/login', {key:$('#key').val()}, () => location.reload()); }
function analyze() {
    $('#btnAn').text('SINKRONISASI...').attr('disabled', true);
    $.post('/analyze', {market:$('#market').val()}, function(d) {
        $('#btnAn').text('PROSES DATA').attr('disabled', false);
        $('#resultCard').show();
        $('#resMarket').text(d.market);
        $('#resLast').text(d.last);
        $('#resPosisi').text(d.posisi);
        $('#resBbfs').text(d.bbfs.split('').join(' - '));
        $('#resShadow').text(d.shadow.split('').join(' - '));
        $('#res3d').text(d.top3d);
        $('#res4d').text(d.top4d);
        $('#res2dM').text(d.list2d_main);
        $('#res2dS').text(d.list2d_shadow);
    });
}
function takeSs() {
    html2canvas(document.getElementById('resultCard'), {backgroundColor:'#1e293b', scale:3}).then(c => {
        const a = document.createElement('a');
        a.download = 'PREDIKSI_AI.png';
        a.href = c.toDataURL();
        a.click();
    });
}
</script>
</body>
</html>
