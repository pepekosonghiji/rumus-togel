<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH V7.0 | THE BEAST</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --bg: #020617; --neon: #22d3ee; --accent: #f59e0b; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Rajdhani', sans-serif; background-image: radial-gradient(circle at top, #1e293b 0%, #020617 100%); }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; }
        .neon-text { font-family: 'Orbitron'; background: linear-gradient(to right, var(--neon), #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .num-main { font-family: 'Orbitron'; font-size: 1.8rem; color: #fff; text-shadow: 0 0 15px var(--neon); letter-spacing: 5px; }
        .btn-run { background: linear-gradient(135deg, #0891b2, #4f46e5); border: none; color: white; font-weight: bold; padding: 12px; border-radius: 12px; width: 100%; font-family: 'Orbitron'; }
        .btn-screenshot { background: #10b981; border: none; color: white; font-weight: bold; padding: 10px; border-radius: 12px; width: 100%; margin-top: 10px; font-family: 'Orbitron'; font-size: 0.8rem; }
        .box-pos { background: rgba(0,0,0,0.5); border-radius: 10px; padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .label-tech { font-size: 0.6rem; color: #94a3b8; letter-spacing: 2px; font-weight: 700; display: block; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="text-center mb-4">
        <h1 class="neon-text mb-0">MAMANG TECH V7.0</h1>
        <p class="text-secondary small">ANTI-MISS & AUTO-BB SYSTEM</p>
    </div>

    {% if not logged_in %}
    <div class="col-md-5 mx-auto glass text-center">
        <input type="password" id="key" class="form-control bg-dark text-white border-0 py-3 mb-3 text-center shadow-none" placeholder="LICENSE KEY">
        <button class="btn btn-run" onclick="login()">LOGIN SYSTEM</button>
    </div>
    {% else %}
    <div class="col-lg-6 mx-auto">
        <div class="glass mb-3">
            <select id="market" class="form-select bg-dark text-white border-0 py-3 mb-3 shadow-none">
                {% for m in markets %}<option value="{{m}}">{{m}}</option>{% endfor %}
            </select>
            <button class="btn btn-run" onclick="run()" id="btnGo">ANALYZE NOW</button>
            <button id="btnSS" class="btn-screenshot" style="display:none;" onclick="takeScreenshot()">ðŸ“¸ DOWNLOAD ANALYTICS IMAGE</button>
        </div>

        <div id="captureArea">
            <div id="resultArea" style="display:none;">
                <div class="glass mb-3 text-center" style="border-bottom: 3px solid var(--neon);">
                    <h2 id="vMarketHeader" class="neon-text mb-2"></h2>
                    <div class="d-flex justify-content-center gap-2 small text-info">
                        <span>LAST: <b id="vLast" class="text-white"></b></span> | 
                        <span>7D: <b id="vWeekly" class="text-white"></b></span>
                    </div>
                </div>

                <div class="glass mb-3 border-danger text-center">
                    <span id="vTwinStatus" class="badge bg-danger mb-2"></span>
                    <div id="vTwinPicks" class="h4 text-white fw-bold" style="font-family: 'Orbitron';"></div>
                </div>

                <div class="glass mb-3">
                    <div class="row g-2 mb-3">
                        <div class="col-4 box-pos"><span class="label-tech">DEPAN</span><div id="vDepan" class="fw-bold text-info"></div></div>
                        <div class="col-4 box-pos"><span class="label-tech">TENGAH</span><div id="vTengah" class="fw-bold text-info"></div></div>
                        <div class="col-4 box-pos" style="border-color:var(--neon)"><span class="label-tech">BELAKANG</span><div id="vBelakang" class="fw-bold text-white"></div></div>
                    </div>

                    <div class="p-3 bg-dark rounded-4 border border-info mb-2 text-center">
                        <span class="label-tech" style="color:var(--neon)">CORE 2D BOM (WAJIB BB)</span>
                        <div id="vCore" class="num-main"></div>
                    </div>

                    <div class="p-3 bg-black rounded-4 text-center border border-warning">
                        <span class="label-tech" style="color:var(--accent)">ULTIMATE 6-DIGIT BBFS</span>
                        <div id="vBbfs" class="num-main" style="color:var(--accent); text-shadow:0 0 10px var(--accent);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function login() { $.post('/login', {key:$('#key').val()}, () => location.reload()); }
    
    function run() {
        const mkt = $('#market').val();
        $('#btnGo').prop('disabled', true).text('SCRAPING...');
        $.post('/analyze', {market: mkt}, (d) => {
            $('#btnGo').prop('disabled', false).text('ANALYZE NOW');
            $('#vMarketHeader').text(d.market);
            $('#vLast').text(d.last);
            $('#vWeekly').text(d.weekly);
            $('#vTwinStatus').text(d.data.twin_status);
            $('#vTwinPicks').text(d.data.twin_picks);
            $('#vDepan').text(d.data.depan);
            $('#vTengah').text(d.data.tengah);
            $('#vBelakang').text(d.data.core.split(', ')[0]);
            $('#vCore').text(d.data.core);
            $('#vBbfs').text(d.data.bbfs);
            $('#resultArea').fadeIn();
            $('#btnSS').show();
        });
    }

    function takeScreenshot() {
        const area = document.getElementById('captureArea');
        html2canvas(area, { backgroundColor: '#020617' }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'MAMANG-TECH-' + $('#vMarketHeader').text() + '.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
</html>
