<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH V7.2 | ABSOLUTE ANALYTICS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --bg: #020617; --neon: #22d3ee; --accent: #f59e0b; --red: #ef4444; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Rajdhani', sans-serif; background-image: radial-gradient(circle at top, #1e293b 0%, #020617 100%); min-height: 100vh; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; }
        .neon-text { font-family: 'Orbitron'; background: linear-gradient(to right, var(--neon), #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
        .num-main { font-family: 'Orbitron'; font-size: 2rem; color: #fff; text-shadow: 0 0 15px var(--neon); letter-spacing: 5px; }
        .btn-run { background: linear-gradient(135deg, #0891b2, #4f46e5); border: none; color: white; font-weight: bold; padding: 15px; border-radius: 12px; width: 100%; font-family: 'Orbitron'; letter-spacing: 1px; }
        .btn-ss { background: #059669; border: none; color: white; font-weight: bold; padding: 12px; border-radius: 12px; width: 100%; margin-top: 10px; font-family: 'Orbitron'; font-size: 0.8rem; }
        .box-pos { background: rgba(0,0,0,0.6); border-radius: 15px; padding: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .label-tech { font-size: 0.7rem; color: #94a3b8; letter-spacing: 2px; font-weight: 700; display: block; margin-bottom: 5px; text-transform: uppercase; }
        .badge-data { background: rgba(34, 211, 238, 0.1); border: 1px solid var(--neon); color: var(--neon); padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="text-center mb-4">
        <h1 class="neon-text mb-0">MAMANG TECH V7.2</h1>
        <p class="text-secondary small fw-bold">HYBRID ANALYTICS â€¢ ABSOLUTE SINKRON</p>
    </div>

    {% if not logged_in %}
    <div class="col-md-5 mx-auto glass text-center shadow-lg">
        <label class="label-tech mb-3">System Access Code</label>
        <input type="password" id="key" class="form-control bg-dark text-white border-0 py-3 mb-3 text-center" placeholder="LICENSE KEY">
        <button class="btn btn-run shadow" onclick="login()">AUTHORIZE ACCESS</button>
    </div>
    {% else %}
    <div class="col-lg-6 mx-auto">
        <div class="glass mb-4 border-info">
            <label class="label-tech">Select Market Server</label>
            <select id="market" class="form-select bg-dark text-white border-0 py-3 mb-3 shadow-none">
                {% for m in markets %}<option value="{{m}}">{{m}}</option>{% endfor %}
            </select>
            <button class="btn btn-run" onclick="run()" id="btnGo">EXECUTE ANALYSIS</button>
            <button id="btnSS" class="btn-ss" style="display:none;" onclick="takeScreenshot()">ðŸ“¸ DOWNLOAD ANALYTICS (PNG)</button>
        </div>

        <div id="captureArea">
            <div id="resultArea" style="display:none;">
                <div class="glass mb-3 text-center" style="border-bottom: 3px solid var(--neon);">
                    <h2 id="vMarketHeader" class="neon-text mb-3"></h2>
                    <div class="d-flex justify-content-center gap-2 mb-2">
                        <span class="badge-data">LAST: <b id="vLast" class="text-white"></b></span>
                        <span class="badge-data">7D AGO: <b id="vWeekly" class="text-white"></b></span>
                    </div>
                </div>

                <div id="twinBox" class="glass mb-3 border-danger text-center shadow-sm">
                    <span class="label-tech" style="color: var(--red);">TWIN PROBABILITY STATUS</span>
                    <h5 id="vTwinStatus" class="fw-bold text-white mb-2"></h5>
                    <div id="vTwinPicks" class="num-main" style="color: var(--red); text-shadow: none; font-size: 1.5rem;"></div>
                </div>

                <div class="glass mb-3">
                    <div class="row g-2 mb-4">
                        <div class="col-4 box-pos"><span class="label-tech">DEPAN</span><div id="vDepan" class="text-info fw-bold h5 mb-0"></div></div>
                        <div class="col-4 box-pos"><span class="label-tech">TENGAH</span><div id="vTengah" class="text-info fw-bold h5 mb-0"></div></div>
                        <div class="col-4 box-pos" style="border-color: var(--neon);"><span class="label-tech" style="color:var(--neon)">BELAKANG</span><div id="vBelakang" class="text-white fw-bold h5 mb-0"></div></div>
                    </div>

                    <div class="p-4 bg-dark rounded-4 border border-info border-opacity-25 mb-3 text-center">
                        <span class="label-tech" style="color:var(--neon)">CORE 2D BOM (WAJIB BOLAK-BALIK)</span>
                        <div id="vCore" class="num-main"></div>
                        <small class="text-secondary mt-2 d-block">Teknik: Inverse Head-Tail Weekly Cross</small>
                    </div>

                    <div class="p-4 bg-black rounded-4 text-center border border-warning border-opacity-50">
                        <span class="label-tech" style="color:var(--accent)">ULTIMATE 6-DIGIT BBFS (SAFETY BET)</span>
                        <div id="vBbfs" class="num-main" style="color:var(--accent); text-shadow: 0 0 10px var(--accent); font-size: 2.2rem;"></div>
                        <small class="text-warning d-block mt-2">Cakupan angka hantu: AKTIF</small>
                    </div>
                </div>
                <p class="text-center text-secondary" style="font-size: 0.6rem; letter-spacing: 1px;">MAMANG TECH AI Â© 2026 - ENGINE V7.2 FINAL</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function login() { $.post('/login', {key:$('#key').val()}, () => location.reload()); }
    
    function run() {
        const mkt = $('#market').val();
        $('#btnGo').prop('disabled', true).text('PROCESSING ALGORITHM...');
        $.post('/analyze', {market: mkt}, (d) => {
            $('#btnGo').prop('disabled', false).text('EXECUTE ANALYSIS');
            if(d.error) { alert(d.error); return; }
            
            $('#vMarketHeader').text(d.market);
            $('#vLast').text(d.last);
            $('#vWeekly').text(d.weekly);
            $('#vTwinStatus').text(d.data.twin_status);
            $('#vTwinPicks').text(d.data.twin_picks);
            $('#vDepan').text(d.data.depan);
            $('#vTengah').text(d.data.tengah);
            $('#vBelakang').text(d.data.core.split(', ')[0]);
            $('#vCore').text(d.data.core);
            $('#vBbfs').text(d.data.bbfs);
            
            $('#resultArea').fadeIn(800);
            $('#btnSS').show();
            $('html, body').animate({ scrollTop: $("#resultArea").offset().top - 20 }, 600);
        });
    }

    function takeScreenshot() {
        const area = document.getElementById('captureArea');
        html2canvas(area, { backgroundColor: '#020617', scale: 2, useCORS: true }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'MAMANG-ANALYTICS-' + $('#vMarketHeader').text() + '.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>
</body>
</html>
