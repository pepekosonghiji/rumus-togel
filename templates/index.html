<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH V3.2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020617; --neon: #22d3ee; --accent: #f59e0b; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Rajdhani'; min-height: 100vh; background-image: radial-gradient(circle, #1e293b 0%, #020617 100%); }
        .glass { background: rgba(15, 23, 42, 0.75); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .neon-text { font-family: 'Orbitron'; background: linear-gradient(to right, var(--neon), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 2px; }
        .num-display { background: linear-gradient(180deg, #000, #111); border: 2px solid var(--neon); border-radius: 15px; padding: 20px; font-family: 'Orbitron'; color: var(--neon); font-size: 2rem; text-align: center; letter-spacing: 10px; box-shadow: inset 0 0 15px rgba(34,211,238,0.2); }
        .btn-prime { background: linear-gradient(135deg, #0891b2, #1e40af); border: none; color: #fff; font-weight: bold; border-radius: 12px; padding: 15px; text-transform: uppercase; transition: 0.3s; }
        .btn-prime:hover { box-shadow: 0 0 25px var(--neon); transform: translateY(-3px); }
        .btn-mode { border: 1px solid #334155; color: #94a3b8; background: transparent; padding: 10px; font-size: 0.8rem; }
        .btn-mode.active { border-color: var(--neon); color: var(--neon); background: rgba(34,211,238,0.1); }
        .label-tech { font-size: 0.7rem; text-transform: uppercase; color: #64748b; font-weight: 700; letter-spacing: 1px; display: block; margin-bottom: 5px; }
        .invest-card { background: #000; border: 1px solid var(--accent); border-radius: 15px; font-family: 'Orbitron'; color: var(--accent); font-size: 1.8rem; padding: 15px; }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="neon-text fw-bold mb-0">MAMANG TECH</h1>
        <p class="small text-secondary fw-bold">V3.2 • 5-DIGIT BBFS • 4-LINE INVEST</p>
    </div>

    {% if not logged_in %}
    <div class="col-md-4 mx-auto glass text-center">
        <div class="badge bg-danger mb-3">RESTRICTED AREA</div>
        <input type="password" id="key" class="form-control bg-dark text-white border-0 py-3 mb-3 text-center" placeholder="LICENSE KEY">
        <button class="btn btn-prime w-100" onclick="login()">AUTHENTICATE</button>
    </div>
    {% else %}
    <div class="col-md-7 col-lg-5 mx-auto">
        <div class="glass mb-4">
            <label class="label-tech">Select Market</label>
            <select id="market" class="form-select bg-dark text-white border-0 py-3 mb-4">
                {% for m in markets %}<option value="{{m}}">{{m}}</option>{% endfor %}
            </select>
            
            <label class="label-tech">Calculation Mode</label>
            <div class="d-flex gap-2 mb-4">
                <button class="btn btn-mode w-100 active" id="bFull" onclick="setMode('full')">5-DIGIT BBFS</button>
                <button class="btn btn-mode w-100" id="bInv" onclick="setMode('inv')">VIP 4-LINE 2D</button>
            </div>
            
            <button class="btn btn-prime w-100" onclick="run()" id="btnGo">EXECUTE ENGINE</button>
        </div>

        <div id="resFull" style="display:none;" class="glass animate-in">
            <div class="text-center mb-4">
                <span class="label-tech">BBFS 5-Digit (Hemat Modal)</span>
                <div id="vBbfs" class="num-display mt-2"></div>
                <div class="mt-3 small text-secondary fw-bold" id="vPos"></div>
            </div>
            <label class="label-tech">Invest 2D (20 Line)</label>
            <div id="v2d" class="p-3 bg-black rounded-3 small text-secondary" style="word-break: break-all;"></div>
        </div>

        <div id="resInv" style="display:none;" class="glass border-warning text-center animate-in">
            <span class="label-tech" style="color:var(--accent)">4-Line Invest 2D (Top Priority)</span>
            <div class="row g-2 mt-2">
                <div class="col-3"><div id="i1" class="invest-card"></div></div>
                <div class="col-3"><div id="i2" class="invest-card"></div></div>
                <div class="col-3"><div id="i3" class="invest-card"></div></div>
                <div class="col-3"><div id="i4" class="invest-card"></div></div>
            </div>
            <div class="mt-4 p-2 bg-dark rounded text-warning small fw-bold">TIPS: Gunakan teknik melipat modal jika tidak JP di putaran ini.</div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let mode = 'full';
    function setMode(m) { mode=m; $('.btn-mode').removeClass('active'); (m=='full')?$('#bFull').addClass('active'):$('#bInv').addClass('active'); }
    function login() { $.post('/login', {key:$('#key').val()}, () => location.reload()); }
    function run() {
        $('#btnGo').prop('disabled', true).text('PROCESSING...');
        const mkt = $('#market').val();
        const ep = (mode == 'full') ? '/analyze' : '/analyze-invest';
        $.post(ep, {market: mkt}, (d) => {
            $('#btnGo').prop('disabled', false).text('EXECUTE ENGINE');
            if(mode == 'full') {
                $('#resInv').hide(); $('#vBbfs').text(d.bbfs); $('#v2d').text(d.list2d); $('#vPos').text(d.posisi); $('#resFull').fadeIn();
            } else {
                $('#resFull').hide(); $('#i1').text(d.invest_2d[0]); $('#i2').text(d.invest_2d[1]); $('#i3').text(d.invest_2d[2]); $('#i4').text(d.invest_2d[3]); $('#resInv').fadeIn();
            }
        });
    }
</script>
</body>
</html>
