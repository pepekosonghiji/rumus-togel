<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH PREMIUM V3</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #020617;
            --panel-bg: rgba(15, 23, 42, 0.7);
            --neon-blue: #22d3ee;
            --neon-purple: #8b5cf6;
            --accent: #3b82f6;
        }

        body {
            background: var(--bg-dark);
            color: #f8fafc;
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #020617 100%);
        }

        .neon-text {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(to right, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            padding: 2rem;
        }

        .btn-premium {
            background: linear-gradient(135deg, #0891b2 0%, #1e40af 100%);
            border: none;
            font-weight: bold;
            letter-spacing: 2px;
            transition: 0.4s;
            color: white;
            border-radius: 12px;
            padding: 12px;
            text-transform: uppercase;
        }

        .btn-premium:hover {
            box-shadow: 0 0 25px rgba(34, 211, 238, 0.5);
            transform: translateY(-3px);
            color: white;
        }

        .btn-outline-tech {
            border: 1px solid var(--accent);
            color: var(--neon-blue);
            background: transparent;
            font-weight: 600;
            transition: 0.3s;
        }

        .btn-outline-tech.active {
            background: var(--accent);
            color: white;
        }

        .num-display {
            background: #020617;
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--accent);
            font-family: 'Orbitron';
            font-size: 2rem;
            letter-spacing: 6px;
            color: var(--neon-blue);
            text-shadow: 0 0 15px rgba(34, 211, 238, 0.3);
            margin: 10px 0;
        }

        .label-tech {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #64748b;
            font-weight: 700;
            display: block;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .market-select {
            background: #0f172a !important;
            border: 1px solid #334155 !important;
            color: white !important;
            border-radius: 10px;
        }

        .invest-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            font-size: 0.9rem;
            line-height: 1.8;
            max-height: 150px;
            overflow-y: auto;
            border-left: 4px solid var(--neon-purple);
        }

        /* Animation */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="text-center mb-5 fade-in">
        <h1 class="neon-text fw-bold mb-0">MAMANG TECH</h1>
        <p class="text-secondary small fw-bold">V3.0 PREDICTIVE ANALYTICS ENGINE</p>
    </div>

    {% if not logged_in %}
    <div class="col-md-5 col-lg-4 mx-auto fade-in">
        <div class="glass-panel text-center">
            <div class="mb-4">
                <div class="badge bg-danger mb-2">RESTRICTED ACCESS</div>
                <h4 class="fw-bold">LICENSE AUTH</h4>
            </div>
            <input type="password" id="licenseKey" class="form-control mb-3 py-3 text-center bg-dark text-white border-0" placeholder="ENTER ACCESS KEY">
            <button class="btn btn-premium w-100 py-3" onclick="handleLogin()">AUTHENTICATE</button>
        </div>
    </div>
    {% else %}

    <div class="col-md-8 col-lg-6 mx-auto fade-in">
        <div class="glass-panel mb-4">
            <div class="row g-3">
                <div class="col-12">
                    <span class="label-tech">Select Pool Market</span>
                    <select id="market" class="form-select market-select py-3">
                        {% for m in markets %}<option value="{{m}}">{{m}}</option>{% endfor %}
                    </select>
                </div>
                
                <div class="col-12">
                    <span class="label-tech">Algorithm Engine</span>
                    <div class="d-flex gap-2 mb-4">
                        <button class="btn btn-outline-tech w-100 py-2 active" id="btnHybrid" onclick="setRumus('hybrid')">AI CORE V3</button>
                        <button class="btn btn-outline-tech w-100 py-2" id="btnRumus1" onclick="setRumus('rumus_1')">RUMUS-1.PY</button>
                    </div>
                </div>

                <div class="col-12 text-center">
                    <button class="btn btn-premium w-100 py-3" onclick="runExecution()" id="btnAction">EXECUTE ANALYTICS</button>
                    <div id="loader" class="mt-3 text-info small fw-bold" style="display:none;">SYNCHRONIZING DATA...</div>
                </div>
            </div>
        </div>

        <div id="resultPanel" style="display:none;" class="fade-in">
            <div class="glass-panel">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h3 id="resMarket" class="neon-text mb-0"></h3>
                        <small class="text-secondary">LATEST DRAW: <span id="resLast" class="text-white fw-bold"></span></small>
                    </div>
                    <span id="resPosisi" class="badge bg-primary px-3 py-2"></span>
                </div>

                <div class="mb-4 text-center">
                    <span class="label-tech">Main BBFS (Primary)</span>
                    <div id="resBbfs" class="num-display"></div>
                </div>

                <div class="mb-4 text-center">
                    <span class="label-tech">Shadow BBFS (Backup)</span>
                    <div id="resShadow" class="num-display fs-4 py-3" style="border-style: dashed; opacity: 0.7;"></div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="bg-dark p-3 rounded-4 border border-secondary text-center">
                            <span class="label-tech">Top 3D Set</span>
                            <div id="res3d" class="text-info fw-bold fs-5"></div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="bg-dark p-3 rounded-4 border border-secondary text-center">
                            <span class="label-tech">Top 4D Set</span>
                            <div id="res4d" class="text-info fw-bold fs-5"></div>
                        </div>
                    </div>
                </div>

                <div>
                    <span class="label-tech">Permutation 2D Invest:</span>
                    <div id="res2d" class="invest-box text-secondary"></div>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <button class="btn btn-sm btn-link text-secondary text-decoration-none" onclick="window.print()">[ PRINT REPORT ]</button>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let currentRumus = 'hybrid';

    function setRumus(val) {
        currentRumus = val;
        $('.btn-outline-tech').removeClass('active');
        if(val === 'hybrid') $('#btnHybrid').addClass('active');
        else $('#btnRumus1').addClass('active');
    }

    function handleLogin() {
        const key = $('#licenseKey').val();
        if(!key) return alert('Key Required!');
        
        $.post('/login', {key: key}, function(data) {
            location.reload();
        }).fail(function() {
            alert('Access Denied: Invalid License Key');
        });
    }

    function runExecution() {
        const market = $('#market').val();
        $('#btnAction').prop('disabled', true).text('PROCESSING...');
        $('#loader').show();
        $('#resultPanel').hide();

        $.post('/analyze', {
            market: market,
            rumus_type: currentRumus
        }, function(data) {
            setTimeout(() => {
                $('#loader').hide();
                $('#btnAction').prop('disabled', false).text('EXECUTE ANALYTICS');
                
                // Populate Data
                $('#resMarket').text(data.market);
                $('#resLast').text(data.last);
                $('#resBbfs').text(data.bbfs);
                $('#resShadow').text(data.shadow);
                $('#res3d').text(data.top3d);
                $('#res4d').text(data.top4d);
                $('#resPosisi').text(data.posisi);
                $('#res2d').text(data.list2d_main);
                
                $('#resultPanel').fadeIn();
            }, 800);
        }).fail(function() {
            alert('Error: Connectivity lost or Session expired.');
            location.reload();
        });
    }
</script>
</body>
</html>
