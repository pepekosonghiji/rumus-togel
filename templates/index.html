<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH V3 PREMIUM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #020617; --neon: #22d3ee; --accent: #8b5cf6; }
        body { background: var(--bg); color: #f8fafc; font-family: 'Rajdhani'; background-image: radial-gradient(circle, #1e293b 0%, #020617 100%); min-height: 100vh; }
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 20px; }
        .neon-text { font-family: 'Orbitron'; background: linear-gradient(to right, var(--neon), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .num-display { background: #000; border: 1px solid var(--neon); border-radius: 12px; padding: 15px; font-family: 'Orbitron'; color: var(--neon); font-size: 1.5rem; text-align: center; margin: 5px 0; }
        .btn-tech { background: linear-gradient(135deg, #0891b2, #1e40af); border: none; color: white; font-weight: bold; border-radius: 10px; transition: 0.3s; }
        .btn-tech:hover { box-shadow: 0 0 15px var(--neon); transform: translateY(-2px); }
        .btn-outline-tech { border: 1px solid var(--neon); color: var(--neon); background: transparent; }
        .btn-outline-tech.active { background: var(--neon); color: #000; }
        .label-tech { font-size: 0.7rem; text-transform: uppercase; color: #64748b; letter-spacing: 1px; font-weight: bold; }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="text-center mb-4">
        <h2 class="neon-text fw-bold">MAMANG TECH</h2>
        <p class="small text-secondary">V3.1 DYNAMIC SYNC ENGINE</p>
    </div>

    {% if not logged_in %}
    <div class="col-md-4 mx-auto glass-panel text-center">
        <h5 class="mb-3">AUTH REQUIRED</h5>
        <input type="password" id="license" class="form-control bg-dark text-white border-0 mb-3" placeholder="ACCESS KEY">
        <button class="btn btn-tech w-100" onclick="login()">LOGIN</button>
    </div>
    {% else %}
    <div class="col-md-6 mx-auto">
        <div class="glass-panel mb-3">
            <label class="label-tech">Market</label>
            <select id="market" class="form-select bg-dark text-white border-0 mb-3">
                {% for m in markets %}<option value="{{m}}">{{m}}</option>{% endfor %}
            </select>
            
            <label class="label-tech">Analysis Mode</label>
            <div class="d-flex gap-2 mb-3">
                <button class="btn btn-outline-tech w-100 active" id="mFull" onclick="setMode('full')">FULL BBFS</button>
                <button class="btn btn-outline-tech w-100" id="mInvest" onclick="setMode('invest')">4-LINE 2D</button>
            </div>
            
            <button class="btn btn-tech w-100 py-3" onclick="execute()">RUN ANALYTICS</button>
        </div>

        <div id="resFull" style="display:none;" class="glass-panel">
            <div class="text-center mb-3"><span id="resM" class="badge bg-primary"></span></div>
            <div class="label-tech text-center">Main BBFS</div>
            <div id="vBbfs" class="num-display"></div>
            <div class="label-tech text-center mt-3">2D Invest (Filtered)</div>
            <div id="v2d" class="small text-secondary p-2 bg-black rounded mt-1" style="word-break: break-all;"></div>
        </div>

        <div id="resInvest" style="display:none;" class="glass-panel border-warning">
            <div class="text-center mb-3"><span class="badge bg-warning text-dark">VIP 4-LINE INVEST</span></div>
            <div class="row g-2">
                <div class="col-3"><div id="i1" class="num-display py-2"></div></div>
                <div class="col-3"><div id="i2" class="num-display py-2"></div></div>
                <div class="col-3"><div id="i3" class="num-display py-2"></div></div>
                <div class="col-3"><div id="i4" class="num-display py-2"></div></div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let mode = 'full';
    function setMode(m) { mode = m; $('.btn-outline-tech').removeClass('active'); (m==='full')?$('#mFull').addClass('active'):$('#mInvest').addClass('active'); }
    function login() { $.post('/login', {key: $('#license').val()}, () => location.reload()); }
    function execute() {
        const mkt = $('#market').val();
        const ep = (mode === 'full') ? '/analyze' : '/analyze-invest';
        $.post(ep, {market: mkt}, (data) => {
            if(mode === 'full') {
                $('#resInvest').hide(); $('#resM').text(data.market); $('#vBbfs').text(data.bbfs); $('#v2d').text(data.list2d_main); $('#resFull').fadeIn();
            } else {
                $('#resFull').hide(); $('#i1').text(data.invest_2d[0]); $('#i2').text(data.invest_2d[1]); $('#i3').text(data.invest_2d[2]); $('#i4').text(data.invest_2d[3]); $('#resInvest').fadeIn();
            }
        });
    }
</script>
</body>
</html>
