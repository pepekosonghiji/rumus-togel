<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMANG TECH - AI Prediksi Togel 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { background-color: #1e293b; border: 1px solid #334155; border-radius: 15px; }
        .btn-primary { background-color: #3b82f6; border: none; font-weight: 600; }
        .btn-primary:hover { background-color: #2563eb; }
        .result-box { background-color: #0f172a; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .badge-custom { font-size: 1.1rem; padding: 8px 15px; border-radius: 10px; background-color: #334155; }
        .text-neon { color: #38bdf8; text-shadow: 0 0 5px rgba(56, 189, 248, 0.5); }
        .invest-box { font-size: 0.9rem; color: #94a3b8; word-wrap: break-word; }
        #loading { display: none; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="text-center mb-4">
                <h1 class="fw-bold text-neon"><i class="fas fa-robot me-2"></i>MAMANG TECH AI</h1>
                <p class="text-secondary">Hybrid Analysis: Hot/Cold, Skip Spacing, & Day Correlation</p>
            </div>

            {% if not logged_in %}
            <div class="card shadow-lg p-4 mb-4">
                <h4 class="text-center mb-3">Akses Restricted</h4>
                <div class="input-group">
                    <input type="password" id="key" class="form-control" placeholder="Masukkan Lisensi Key...">
                    <button class="btn btn-primary" onclick="login()">Buka Akses</button>
                </div>
                <div id="loginMsg" class="mt-2 text-danger text-center small"></div>
            </div>
            {% else %}
            <div class="card shadow-lg p-4 mb-4">
                <div class="mb-3">
                    <label class="form-label">Pilih Market / Server</label>
                    <select id="market" class="form-select form-select-lg">
                        {% for m in markets %}
                        <option value="{{ m }}">{{ m }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button class="btn btn-primary btn-lg w-100" onclick="analyze()" id="btnAnalyze">
                    <i class="fas fa-microchip me-2"></i>MULAI ANALISA DATA
                </button>
                
                <div id="loading" class="text-center mt-3">
                    <div class="spinner-border text-neon" role="status"></div>
                    <p class="mt-2 small">Sedang melakukan Triple-Engine Scraping...</p>
                </div>
            </div>

            <div id="resultCard" class="card shadow-lg p-4" style="display: none;">
                <h3 id="resMarket" class="text-center text-neon fw-bold mb-4">MARKET NAME</h3>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="result-box">
                            <small class="text-secondary d-block">Result Terakhir:</small>
                            <span id="resLast" class="h4 fw-bold text-white">0000</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="result-box">
                            <small class="text-secondary d-block">Posisi Jitu:</small>
                            <span id="resPosisi" class="h5 fw-bold text-warning">Kpl: - | Ekr: -</span>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h5 class="text-neon"><i class="fas fa-layer-group me-2"></i>BBFS Campuran (Utama)</h5>
                    <div id="resBbfs" class="badge-custom text-white d-inline-block w-100 text-center tracking-widest fw-bold"></div>
                </div>

                <div class="mt-3">
                    <h5 class="text-info"><i class="fas fa-ghost me-2"></i>BBFS Shadow (Cadangan)</h5>
                    <div id="resShadow" class="badge-custom text-white d-inline-block w-100 text-center fw-bold" style="background-color: #1e293b; border: 1px dashed #0ea5e9;"></div>
                </div>

                <hr class="my-4 border-secondary">

                <div class="row">
                    <div class="col-6">
                        <small class="text-secondary">TOP 3D:</small>
                        <p id="res3d" class="fw-bold text-white"></p>
                    </div>
                    <div class="col-6">
                        <small class="text-secondary">TOP 4D:</small>
                        <p id="res4d" class="fw-bold text-white"></p>
                    </div>
                </div>

                <div class="mt-4">
                    <button class="btn btn-sm btn-outline-secondary mb-2" type="button" data-bs-toggle="collapse" data-bs-target="#investSection">
                        Tampilkan Invest 2D Full (BB)
                    </button>
                    <div class="collapse" id="investSection">
                        <div class="card card-body bg-dark border-secondary">
                            <h6 class="text-neon small">2D Invest BBFS Utama:</h6>
                            <p id="res2dMain" class="invest-box"></p>
                            <h6 class="text-info small mt-2">2D Invest Shadow:</h6>
                            <p id="res2dShadow" class="invest-box"></p>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <p class="text-center mt-5 text-secondary small">&copy; 2026 MAMANG TECH AI. Dilarang menyalahgunakan script ini.</p>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
function login() {
    const key = $('#key').val();
    $.post('/login', {key: key}, function(data) {
        location.reload();
    }).fail(function(xhr) {
        $('#loginMsg').text(xhr.responseJSON.message);
    });
}

function analyze() {
    const market = $('#market').val();
    $('#loading').show();
    $('#resultCard').hide();
    $('#btnAnalyze').attr('disabled', true);

    $.post('/analyze', {market: market}, function(data) {
        $('#loading').hide();
        $('#btnAnalyze').attr('disabled', false);
        $('#resultCard').fadeIn();

        $('#resMarket').text(data.market);
        $('#resLast').text(data.last);
        $('#resPosisi').text(data.posisi);
        $('#resBbfs').text(data.bbfs.split('').join(' - '));
        $('#resShadow').text(data.shadow.split('').join(' - '));
        $('#res3d').text(data.top3d);
        $('#res4d').text(data.top4d);
        $('#res2dMain').text(data.list2d_main);
        $('#res2dShadow').text(data.list2d_shadow);
    }).fail(function() {
        alert("Gagal mengambil data. Coba lagi.");
        $('#loading').hide();
        $('#btnAnalyze').attr('disabled', false);
    });
}
</script>

</body>
</html>
